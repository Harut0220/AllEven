<link rel="stylesheet" href="/styles/event.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<style>
    .center {
  margin: auto;
  width: 50%;
  padding: 10px;
}
#imageModal{
  position: fixed !important;
  top: 0;
  left: 0;
  background-color: rgba(0, 0, 0, 0.391);
  width: 100%;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
}

.imgaeModal_block{
  display: flex;
  flex-direction: column;
  padding: 40px;
  border-radius: 10px;
  background-color: aliceblue;
  margin: 0 auto;
  position: relative;
}
#modalImage{
width: 100%;
    height: 100%;}
#div_x{
  display: flex;
  flex-direction: column;
  height: 500px;
}
#closeModal{
    font-size: 30px;
    padding: 10px;
    position: absolute;
    right: 5px;
    top: -10px;
}

.removeButton{
  width: 20px;
  height: 20px;
  cursor: pointer;
}

</style>
<div id="events" class="max-height-auto" style="display: flex;position: relative">
  <div class="modal"><img src="/icon/icons8-verified-48.png" alt=""><span class="modalText"></span></div>
        <div class="eventMainBody">
          <div class="eventHead">
            <div class="eventHeadFirstPart">
              <p><a href="/">Главная</a> &gt; <a href="/admin/profile/events">События</a>  &gt; <a id="changeNavText">Все событии</a></p>
            </div>
          </div>
          <div id="eventBody">
            <div id="changeEvMainDiv">
            <div id="changeEvMainDivContainer1">
              <div id="changeEvBox_header">
                <h4>Новое Событие</h4>
                <div id="allowDiv">
                  <button class="buttonAllow whiteBtn" onclick="toggleModal('denyDiv','block')">
                    Отклонить
                  </button>
                  <form action="/admin/profile/event/edit/{{getValue event "_id"}}" method="POST" enctype="multipart/form-data" id="eventForm">
                  <button type="button" class="buttonAllow" onclick="buttonFunc()">
                    {{#if (eq (getValue event "status") 0)}}Одобрить
                    {{else}}Изменить
                    {{/if}}
                  </button>
                </div>
              </div>
            </div>
            <hr>
            <div id="changeEvMainDivContainer2">
              <div class="changeEvBox">
                     <div class="userDiv">
                        <img src="/{{getValue userMeet "avatar"}}" alt=""
                        class="user_image" onclick="openImageModal('{{getValue userMeet "avatar"}}')">
                        <div class="userData">
                          <p class="userName">
                            {{getValue userMeet "name"}} {{getValue userMeet "surname"}}
                          </p>
                          <p class="user_data">{{getValue userMeet "phone_number"}}</p>
                          <p class="user_data">{{getValue userMeet "email"}}</p>
                        </div>
                     </div>
                <div class="changeEvBoxCont">
                     <div id="pics1">
                         {{#if images}}
                             {{#each images}}
                                 {{!-- <div class="changeEvDiv" style="background-image: url('/{{name}}')" onclick="openImageModal('{{name}}')"> --}}
                                    <div class="changeEvDiv" style="padding:2px;cursor:pointer;background-image: url('/{{name}}')" onclick="openImageModal('{{name}}')">
                                    <svg onclick="removeimage(this)" attr_id="{{_id}}" class="removeButton" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--!Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M135.2 17.7L128 32 32 32C14.3 32 0 46.3 0 64S14.3 96 32 96l384 0c17.7 0 32-14.3 32-32s-14.3-32-32-32l-96 0-7.2-14.3C307.4 6.8 296.3 0 284.2 0L163.8 0c-12.1 0-23.2 6.8-28.6 17.7zM416 128L32 128 53.2 467c1.6 25.3 22.6 45 47.9 45l245.8 0c25.3 0 46.3-19.7 47.9-45L416 128z" fill="white"/></svg>
                                 </div>
                             {{/each}}
                         {{/if}}
                     </div>
                  <div class="changeEvBoxContDiv">
                    <input type="text" class="inputAllow" placeholder="Название событий" value="{{getValue event "name"}}" name="name">
                    <span style="margin-top: 15px;">Категория</span>
                    <select class="inputAllow" name="category">
                      <option selected="" disabled="" hidden="">{{category}}</option>
                      {{#if eventCats}}
                        {{#each eventCats}}
                          <option value="{{_id}}">{{name}}</option>
                        {{/each}}
                      {{/if}}
                    </select>
                    <div id="boxDescription">
                      <textarea id="textarea" name="description textarea_description">{{getValue event "description" }}</textarea>
                    </div>
                    <div class="changeEvSMBox">
                      <p>Дата и время начала события</p>
                      <div>
                        <input type="datetime" class="dataInp" value="{{getValue event "started_time"}}" name="started_time">
                      </div>
                    </div>
                    <div class="changeEvSMBox">
                    </div>
                  </div>
                </div>
              </div>
              <div class="changeEvBox">
                <div class="allEvBox_box2">
                  <p class="changeHeadP">Место события</p>
                  <div class="flex_JC_Space-between">
                    <p class="changeText" id="addressLine">{{getValue event "address"}}</p>
                    <img src="/images/pics/locationIcon.svg" style="cursor: pointer">
                  </div>
                </div>
                <div class="allEvBox_box2">
                  <p class="changeHeadP">Ссылка на билеты</p>
                  <div class="head">
                    <label for="">  Сделать ссылку активной </label>
                    <input type="checkbox" name="tickets_link_active" {{#if (getValue event "tickets_link_active")}} checked {{/if}} value="1">
                  </div>
                  <div class="input-img-box">
                    <input type="text" class="inputAllow inp10" placeholder="Вставьте ссылку" value="{{getValue event "tickets_link" }}" name="tickets_link">
                    <img class="imageText1" src="/images/pics/text1.svg" alt="" srcset="">
                  </div>
                  <div class="input-img-box">
                    <input type="text" class="inputAllow inp10" placeholder="Ссылка на веб сайт" value="{{getValue event "website_link" }}" name="website_link">
                    <img class="imageText1" src="/images/pics/text1.svg" alt="" srcset="">
                  </div>
                </div>
              </div>
            </div>
            </form>
          </div>
          </div>
        </div>
      </div>
      <div  id="denyDiv"  style="width:100%;height:870px;background:#12121255;position:absolute;display:none">
      <div id='denyDivChild' >
        <form action="/admin/profile/event/reject/{{getValue event "_id"}}" method="POST">
        <div id="denyDivCont1">
          <p>Причина отклонения События</p>
          <img src="/images/pics/GroupX.svg" onclick="toggleModal('denyDiv','flex')">
        </div>
        <div id="denyDivCont2">
          <textarea id="denyTextarea" cols="20" rows="10" placeholder="Причина" name="status"></textarea>
          <button >Отправить</button>
        </div>
        </form>
      </div></div>

      <script src="/js/axios.js"></script>
            <div id="imageModal" style="display: none;">
           <div class="imgaeModal_block">
                <button id="closeModal" onclick="closeFunc()" >
                x
              </button>
              <div id="div_x">
                <img id="modalImage"  src="" />
              </div>
           </div>
      </div>
      <script>

 function buttonFunc() {
    const modal=document.querySelector('.modal');
  modal.style.display = 'flex';
 
    setTimeout(() => {
      const form = document.getElementById('eventForm'); 
      form.submit(); 
    }, 1000); 
  }

   
        //const geoCordLatit = "{{ event.latitude }}";
        //const geoCordLotit = "{{ event.longitude}}";
        //const geoPath = `https://api.geoapify.com/v1/geocode/reverse?lat=${geoCordLatit}&lon=${geoCordLotit}&apiKey=5d33a1ddd9db4ee8862f3de928c21e89`;
         //axios.get(geoPath).then((d)=>{
         // const al = document.getElementById('addressLine');
        //  al.innerHTML = d.data.features[0].properties.address_line2
       // })

      function removeimage(el){
        let id = el.getAttribute('attr_id');
        el.parentNode.remove()
         axios.delete(`/admin/profile/event/image/${id}`).then((d)=>{
          
        })
      }
     const imgModal=document.getElementById('modalImage')
       function openImageModal(path){
    imgModal.src=`/${path}`

  }


    function closeFunc(e){
          const imageModal=document.getElementById('imageModal')
        imageModal.style.display='none'
  }



    document.querySelectorAll('.user_image').forEach(el => {
      el.addEventListener('click', (e)=>{
       if(e.target.localName!=="path"){
         const imageModal=document.getElementById('imageModal')
         imageModal.style.display='flex'
         imageModal.style.position='absolute'
         imageModal.style.margin='0 auto'
       }
     }) 
     })



      document.querySelectorAll('.changeEvDiv').forEach(el=>{
        el.addEventListener('click', (e)=>{
       if(e.target.localName!=="path"){
         const imageModal=document.getElementById('imageModal')
         imageModal.style.display='flex'
         imageModal.style.position='absolute'
         imageModal.style.margin='0 auto'
       }
     }) 
      })
 
      </script>
      <script src="/js/helper.js"></script>
     




